prcc_result2015
# create data frames
prcc_df_2014 <- data.frame(
Parameter = colnames(lhs_scaled_normal2014),
PRCC = prcc_result2014$PRCC[,1]
)
prcc_df_2015 <- data.frame(
Parameter = colnames(lhs_scaled_normal2015),
PRCC = prcc_result2015$PRCC[,1]
)
#plots
ggplot(prcc_df_2014, aes(x = Parameter, y = PRCC)) +
geom_col(fill = "lightgreen") +
coord_cartesian(ylim = c(-1, 1)) +
labs(title = "PRCC Values - 2014", y = "PRCC", x = "Parameter") +
geom_hline(yintercept = c(0.5, -0.5), color = "blue", linewidth = 0.3, linetype = "dashed") +
theme_minimal() +
theme(
plot.title = element_text(hjust = 0.5),
axis.text = element_text(size = 12),
axis.title = element_text(size = 14)
)
ggplot(prcc_df_2015, aes(x = Parameter, y = PRCC)) +
geom_col(fill = "lightgreen") +
coord_cartesian(ylim = c(-1, 1)) +
labs(title = "PRCC Values - 2015", y = "PRCC") +
geom_hline(yintercept = c(0.5, -0.5), color = "blue", linewidth = 0.3, linetype = "dashed") +
theme_minimal() +
theme(
plot.title = element_text(hjust = 0.5),
axis.text = element_text(size = 12),
axis.title = element_text(size = 14)
)
ggplot(prcc_df_2014, aes(x = Parameter, y = PRCC)) +
geom_col(fill = "lightgreen") +
coord_cartesian(ylim = c(-1, 1)) +
labs(title = "PRCC Values - 2014", y = "PRCC", x = "Parameter") +
geom_hline(yintercept = c(0.5, -0.5), color = "blue", linewidth = 0.3, linetype = "dashed") +
theme_minimal() +
theme(
plot.title = element_text(hjust = 0.5),
axis.text = element_text(size = 12),
axis.title = element_text(size = 14)
)
ggplot(prcc_df_2015, aes(x = Parameter, y = PRCC)) +
geom_col(fill = "lightgreen") +
coord_cartesian(ylim = c(-1, 1)) +
labs(title = "PRCC Values - 2015", y = "PRCC") +
geom_hline(yintercept = c(0.5, -0.5), color = "blue", linewidth = 0.3, linetype = "dashed") +
theme_minimal() +
theme(
plot.title = element_text(hjust = 0.5),
axis.text = element_text(size = 12),
axis.title = element_text(size = 14)
)
prcc_df_2015 <- data.frame(
Parameter = colnames(lhs_scaled_normal2015),
PRCC = prcc_result2015$PRCC[,1]
)
#plots
ggplot(prcc_df_2014, aes(x = Parameter, y = PRCC)) +
geom_col(fill = "lightgreen") +
coord_cartesian(ylim = c(-1, 1)) +
labs(title = "PRCC Values - 2014", y = "PRCC", x = "Parameter") +
geom_hline(yintercept = c(0.5, -0.5), color = "blue", linewidth = 0.3, linetype = "dashed") +
theme_minimal() +
theme(
plot.title = element_text(hjust = 0.5),
axis.text = element_text(size = 12),
axis.title = element_text(size = 14)
)
# GOAL: solve logL(R) = logL(R0) - 2 (i.e. what values of R make logL(R) the same as logL(R0) - 2)
# function that solves for log likelihood of any given value of R
log_likelihood <- function(R, Nh, wh_dist = "gamma", wm_dist = "gamma", dist_params = list()) {
if (R <= 0) return(-Inf)  # avoid invalid values
t_final <- length(Nh)
# 1. Generate weights
get_weights <- function(dist_name, params, max_len) {
if (dist_name == "gamma") {
if (!is.null(params$scale)) {
return(dgamma(1:max_len, shape = params$shape, scale = params$scale))
} else if (!is.null(params$rate)) {
return(dgamma(1:max_len, shape = params$shape, rate = params$rate))
} else {
stop("Gamma distribution requires either 'rate' or 'scale'")
}
} else if (dist_name == "lognorm") {
return(dlnorm(1:max_len, meanlog = params$meanlog, sdlog = params$sdlog))
} else if (dist_name == "weibull") {
return(dweibull(1:max_len, shape = params$shape, scale = params$scale))
} else if (dist_name == "nbinom") {
return(dnbinom(1:max_len, size = params$size, prob = params$prob))
} else {
stop("Unsupported distribution.")
}
}
max_len <- t_final  # safe max length for weights
wh <- get_weights(wh_dist, dist_params$wh, max_len)
wm <- get_weights(wm_dist, dist_params$wm, max_len)
# 2. Compute A term (nested summations)
A <- 0
for (t in 1:t_final) {
inner_sum <- 0
for (s in 1:t) {
nested_sum <- 0
for (u in 1:(t - s + 1)) {
idx <- t - s + 1 - u + 1  # convert to 1-based indexing
if (idx >= 1 && idx <= t_final) {
nested_sum <- nested_sum + Nh[idx] * wh[u]
}
}
inner_sum <- inner_sum + nested_sum * wm[s]
}
A <- A + inner_sum
}
B <- sum(Nh)
log_factorials <- sum(lgamma(Nh + 1))  # ln(N!) = lgamma(N + 1)
logL <- -log_factorials - R^2 * A + B * (2 * log(R) + log(A))
return(logL)
}
#function to calculate gamma parameters
gamma_params <- function(mean, sd, daily){
if(daily == TRUE){
shape <- calc_k_daily(mean, sd)
scale <- calc_theta_daily(mean, sd)
} else {
shape <- calc_k_wkly(mean, sd)
scale <- calc_theta_wkly(mean, sd)
}
return (list(shape = shape, scale = scale))
}
# function to find Confidence Interval
find_ci_bounds <- function(R0, Nh, log_likelihood_fn, dist_params, wh_dist = "gamma", wm_dist = "gamma",
R_range = c(0.01, 10)) {
# Step 1: Evaluate log-likelihood at R0
logLik_R0 <- log_likelihood_fn(R0, Nh = Nh, wh_dist = wh_dist, wm_dist = wm_dist, dist_params = dist_params)
# Step 2: Define the root equation to solve: logL(R) - (logL(R0) - 2)
target_logL <- logLik_R0 - 2
root_func <- function(R) {
log_likelihood_fn(R, Nh = Nh, wh_dist = wh_dist, wm_dist = wm_dist, dist_params = dist_params) - target_logL
}
# Step 3: Find lower bound (left of R0)
lower_bound <- tryCatch({
uniroot(root_func, lower = R_range[1], upper = R0)$root
}, error = function(e) NA)
# Step 4: Find upper bound (right of R0)
upper_bound <- tryCatch({
uniroot(root_func, lower = R0, upper = R_range[2])$root
}, error = function(e) NA)
return(c(lower = lower_bound, upper = upper_bound))
}
# serial interval distribution parameters, gamma in this case
dist_params <- list(
wh = gamma_params(mean = 4, sd = 2, daily = TRUE),
wm = gamma_params(mean = 4, sd = 2, daily = TRUE)
)
# base case R0 for 2014 cases
R0 <-  calc_basicR(cases = daily2014_growth$Cases,
mean_h = 4, sd_h = 2,
mean_m = 4, sd_m = 2, weekly_data = FALSE) # you obtained this using your own equation
ci <- find_ci_bounds(
R0 = R0,
Nh = daily2014_growth$Cases,
log_likelihood_fn = log_likelihood,
dist_params = dist_params,
wh_dist = "gamma",
wm_dist = "gamma",
R_range = c(0.01, 10)
)
print(ci)
#2015
# serial interval distribution parameters, gamma in this case
dist_params <- list(
wh = gamma_params(mean = 4, sd = 2, daily = TRUE),
wm = gamma_params(mean = 4, sd = 2, daily = TRUE)
)
# base case R0 for 2015 cases
R0 <-  calc_basicR(cases = daily2015_growth$Cases,
mean_h = 6, sd_h = 2,
mean_m = 6, sd_m = 2, weekly_data = FALSE) # you obtained this using your own equation
ci <- find_ci_bounds(
R0 = R0,
Nh = daily2015_growth$Cases,
log_likelihood_fn = log_likelihood,
dist_params = dist_params,
wh_dist = "gamma",
wm_dist = "gamma",
R_range = c(0.01, 10)
)
print(ci)
#TEST DATA
# serial interval distribution parameters, gamma in this case
test_data <- c(1,2,4,8,16,32,64,128)
dist_params <- list(
wh = gamma_params(mean = 4, sd = 2, daily = TRUE),
wm = gamma_params(mean = 4, sd = 2, daily = TRUE)
)
# base case R0 for 2014 cases
R0 <-  calc_basicR(cases = test_data,
mean_h = 4, sd_h = 2,
mean_m = 4, sd_m = 2, weekly_data = FALSE) # you obtained this using your own equation
ci <- find_ci_bounds(
R0 = R0,
Nh = test_data,
log_likelihood_fn = log_likelihood,
dist_params = dist_params,
wh_dist = "gamma",
wm_dist = "gamma",
R_range = c(0.01, 10)
)
print(ci)
# serial interval distribution parameters, gamma in this case
dist_params <- list(
wh = gamma_params(mean = 4, sd = 2, daily = TRUE),
wm = gamma_params(mean = 4, sd = 2, daily = TRUE)
)
# base case R0 for 2014 cases
R0 <-  calc_basicR(cases = daily2014_growth$Cases,
mean_h = 4, sd_h = 2,
mean_m = 4, sd_m = 2, weekly_data = FALSE) # you obtained this using your own equation
ci <- find_ci_bounds(
R0 = R0,
Nh = daily2014_growth$Cases,
log_likelihood_fn = log_likelihood,
dist_params = dist_params,
wh_dist = "gamma",
wm_dist = "gamma",
R_range = c(0.01, 10)
)
print("2014:")
print(ci)
#2015
# serial interval distribution parameters, gamma in this case
dist_params <- list(
wh = gamma_params(mean = 4, sd = 2, daily = TRUE),
wm = gamma_params(mean = 4, sd = 2, daily = TRUE)
)
# base case R0 for 2015 cases
R0 <-  calc_basicR(cases = daily2015_growth$Cases,
mean_h = 6, sd_h = 2,
mean_m = 6, sd_m = 2, weekly_data = FALSE) # you obtained this using your own equation
ci <- find_ci_bounds(
R0 = R0,
Nh = daily2015_growth$Cases,
log_likelihood_fn = log_likelihood,
dist_params = dist_params,
wh_dist = "gamma",
wm_dist = "gamma",
R_range = c(0.01, 10)
)
print("2015:")
print(ci)
knitr::opts_chunk$set(
echo = TRUE,
message = TRUE,
warning = TRUE
)
#load libraries
library(ggplot2)      # for line graphs and heat maps
library(RColorBrewer) # for heatmap colors
library(scales)
library(dplyr)
library(lhs)          # for latin hypercube sampling (LHS)
library(truncnorm)    # for transforming LHS (truncated normal inverse CDF)
library(sensitivity)
options(scipen = 999)
#load the data set
dengue_ds <- read.csv("/Users/jaynasnyder/Desktop/SDSU/DiMo/dengue-weekly.csv")
head(dengue_ds)
#load daily dataset
dengue_daily_ds <- read.csv("/Users/jaynasnyder/Desktop/SDSU/DiMo/dengue-daily-taiwan.csv")
head(dengue_daily_ds)
#subset for only confirmed cases, add Week_t column to use as index (t = week 1)
dengue_wkly2024 <- data.frame(week_t = 1:52, Confirmed_Cases = dengue_ds$Number.of.Confirmed.Cases[1:52])
head(dengue_wkly2024)
# clean and subset daily data
#change date from character to date type
dengue_daily_ds$DATE <- as.Date(dengue_daily_ds$DATE, format = "%d%b%Y")
#subset 2014
dengue_daily2014 <- dengue_daily_ds[grep(pattern = 2014, x = dengue_daily_ds$DATE), c("DATE", "Dengue_local_case") ]
names(dengue_daily2014) <- c("Date", "Cases")
dengue_daily2014
#write.csv(x= dengue_daily2014, file = "/Users/jaynasnyder/Desktop/SDSU/DiMo/dengue-daily2014.csv")
#subset 2015
dengue_daily2015 <- dengue_daily_ds[grep(pattern = 2015, x = dengue_daily_ds$DATE), c("DATE", "Dengue_local_case") ]
names(dengue_daily2015) <- c("Date", "Cases")
head(dengue_daily2015)
#write.csv(x= dengue_daily2015, file = "/Users/jaynasnyder/Desktop/SDSU/DiMo/dengue-daily2015.csv")
# Plot data
barplot(dengue_wkly2024$Confirmed_Cases ~ dengue_wkly2024$week_t)
barplot(dengue_daily2014$Cases ~ dengue_daily2014$Date)
barplot(dengue_daily2015$Cases ~ dengue_daily2015$Date)
print('2014 Growth Period:')
# no more zeros in 2014 starting 2014-06-19
dengue_daily2014$Date[dengue_daily2014$Date == "2014-06-19"]
dengue_daily2014$Date[which.max(dengue_daily2014$Cases)]
print('2015 Growth Period:')
# no more zeros in 2015 starting 2015-06-29
dengue_daily2015$Date[dengue_daily2015$Date == "2015-06-29"]
dengue_daily2015$Date[which.max(dengue_daily2015$Cases)]
#subset 2014 growth period
d14 <- dengue_daily2014[ dengue_daily2014$Date >= "2014-06-19" , ]
daily2014_growth <- d14[d14$Date <= "2014-11-03", ]
daily2014_growth
#subset 2015 growth period
d15 <- dengue_daily2015[ dengue_daily2015$Date >= "2015-06-29" , ]
daily2015_growth <- d15[d15$Date <= "2015-09-18", ]
daily2015_growth
#plot growth periods
barplot(daily2014_growth$Cases ~ daily2014_growth$Date)
barplot(daily2015_growth$Cases ~ daily2015_growth$Date)
calc_basicR <- function(cases, mean_h, sd_h, mean_m, sd_m, weekly_data) {
# calculate parameters
if(weekly_data == TRUE){
k_h <- calc_k_wkly(mean_h, sd_h)
theta_h <- calc_theta_wkly(mean_h, sd_h)
k_m <- calc_k_wkly(mean_m, sd_m)
theta_m <- calc_theta_wkly(mean_m,sd_m)
}
else {
k_h <- calc_k_daily(mean_h, sd_h)
theta_h <- calc_theta_daily(mean_h, sd_h)
k_m <- calc_k_daily(mean_m, sd_m)
theta_m <- calc_theta_daily(mean_m,sd_m)
}
# calculates numerator (sum from t=1 to tfinal, of Nt for Humans)
sum_numerator <- sum(cases)
# calculate denominator
# calculates inside sum from u=1 to s
innersum <- function(s, t){ # +1 outside (t-s+1-u) is for 1-based indexing, so no out of bounds issues
sum(sapply(1:(t-s+1), function(u) sum(cases[(t-s+1-u)+1] * dgamma(u, shape = k_h, scale = theta_h))) * dgamma(s, shape = k_m, scale = theta_m))
}
# calculates inside sum from s=1 to t
middlesum <- function(t){
sum(sapply(1:t,innersum, t = t))
}
#calculates outside sum from t=1 to tfinal-1 because use first as t = 0)
denom <- sum(sapply(1:length(cases), middlesum))
#final R0
R0 <- sqrt(sum_numerator/denom)
R0_info <- list("cases" = cases[1:length(cases)], "total cases (numerator)" = sum_numerator, "sum denominator" = denom, "R0" =R0)
return(R0)
}
#helper function calculate k for weekly data
calc_k_wkly <- function(m, sd){
m_wk <- m/7
sd_wk <- sd/7
k <- (m_wk^2)/(sd_wk^2) # k = mean^2 / variance, /7 for weekly data (assumes mean/sd is in days)
return(k)
}
#helper function calculate theta for weekly data
calc_theta_wkly <- function(m, sd){
theta <- ((sd/7)^2)/(m/7) # theta = variance / mean, /7 for weekly data (assumes mean/sd is in days)
return(theta)
}
#helper function calculate k for daily data
calc_k_daily <- function(m, sd){
k <- (m^2)/(sd^2) # k = mean^2 / variance
return(k)
}
#helper function calculate theta for daily data
calc_theta_daily <- function(m, sd){
theta <- (sd^2)/(m) # theta = variance / mean
return(theta)
}
print("2024 weekly data : Base R0")
calc_basicR(cases = dengue_wkly2024$Confirmed_Cases,
mean_h = 4, sd_h = 2,
mean_m = 4, sd_m = 2, weekly_data = TRUE)
print("2014 daily data : Base R0")
calc_basicR(cases = dengue_daily2014$Cases,
mean_h = 4, sd_h = 2,
mean_m = 4, sd_m = 2, weekly_data = FALSE)
print("2014 daily data - growth period: Base R0")
calc_basicR(cases = daily2014_growth$Cases,
mean_h = 4, sd_h = 2,
mean_m = 4, sd_m = 2, weekly_data = FALSE)
print("2015 daily data : Base R0")
calc_basicR(cases = dengue_daily2015$Cases,
mean_h = 4, sd_h = 2,
mean_m = 4, sd_m = 2, weekly_data = FALSE)
print("2015 daily data - growth period: Base R0")
calc_basicR(cases = daily2015_growth$Cases,
mean_h = 4, sd_h = 2,
mean_m = 4, sd_m = 2, weekly_data = FALSE)
# Create vectors for parameter changes
change_mean_h <- c()
change_mean_m <- c()
change_sd_h <- c()
change_sd_m <- c()
#loop through all values for mean_m and mean_h, calculating and storing corresponding R0
for(i in c(1:21)){
change_mean_h[i] <- calc_basicR(cases = dengue_wkly2024$Confirmed_Cases,
mean_h = i, mean_m = 4, sd_h = 2, sd_m = 2, weekly_data = TRUE)
change_mean_m[i] <- calc_basicR(cases = dengue_wkly2024$Confirmed_Cases,
mean_h = 4, mean_m = i, sd_h = 2, sd_m = 2, weekly_data = TRUE)
}
#loop through all values for sd_m and sd_h, calculating and storing corresponding R0
for(i in c(1:5)){
change_sd_h[i] <- calc_basicR(cases = dengue_wkly2024$Confirmed_Cases,
mean_h = 4, mean_m = 4, sd_h = i, sd_m = 2,  weekly_data = TRUE)
change_sd_m[i] <- calc_basicR(cases = dengue_wkly2024$Confirmed_Cases,
mean_h = 4, mean_m = 4, sd_h = 2, sd_m = i, weekly_data = TRUE)
}
#transform output into numeric vectors
change_mean_h <- as.numeric(change_mean_h)
change_mean_m <- as.numeric(change_mean_m)
change_sd_h <- as.numeric(change_sd_h)
change_sd_m <- as.numeric(change_sd_m)
#create data frames to plot results with
mean_h_sensitivity <- data.frame(mean_h = 1:21, R0 = change_mean_h)
mean_m_sensitivity <- data.frame(mean_m = 1:21, R0 = change_mean_m)
sd_h_sensitivity <- data.frame(sd_h = 1:5, R0 = change_sd_h)
sd_m_sensitivity <- data.frame(sd_m = 1:5, R0 = change_sd_m)
#Plot Local Sensitivity of R0 with respect to mean_h
ggplot(data = mean_h_sensitivity, aes(x= mean_h, y = R0, label = round(R0, 2))) +
geom_point() +
geom_line() +
scale_y_continuous(limits = c(0, NA)) +
geom_text(vjust = -0.75, hjust = 0.75, size = 3) +
geom_hline(yintercept = 1, linetype = "dashed", color = "red") +
labs(title = "Local Sensitivity of R0 with respect to Mean_H", x = "Mean of Human Serial Interval (mean_h in days)", y = "Basic Reproduction Number (R0)")
#Plot Local Sensitivity of R0 with respect to mean_m
ggplot(data = mean_m_sensitivity, aes(x= mean_m, y = R0, label = round(R0,2))) +
geom_point(color = "blue") +
geom_line(color = "blue") +
scale_y_continuous(limits = c(0, NA)) +
geom_text(vjust = -0.75, hjust = 0.5, size = 3) +
geom_hline(yintercept = 1, linetype = "dashed", color = "red") +
labs(title = "Local Sensitivity of R0 with respect to Mean_M", x = "Mean of Mosquito Serial Interval Distribution (mean_m in days)", y = "Basic Reproduction Number (R0)")
#Plot Local Sensitivity of R0 with respect to sd_h
ggplot(data = sd_h_sensitivity, aes(x= sd_h, y = R0, label = round(R0,2))) +
geom_point() +
geom_line() +
scale_y_continuous(limits = c(0, NA)) +
geom_text(vjust = -0.5, hjust = 0.25, size = 4) +
geom_hline(yintercept = 1, linetype = "dashed", color = "red") +
labs(title = "Local Sensitivity of R0 with respect to SD_H", x = "SD of Human Serial Interval Distribution (sd_h in days)", y = "Basic Reproduction Number (R0)")
#Plot Local Sensitivity of R0 with respect to sd_m
ggplot(data = sd_m_sensitivity, aes(x= sd_m, y = R0, label = round(R0,2))) +
geom_point(color = "blue") +
geom_line(color = "blue") +
scale_y_continuous(limits = c(0, NA)) +
geom_text(vjust = -0.5, hjust = 0.25, size = 4) +
geom_hline(yintercept = 1, linetype = "dashed", color = "red") +
labs(title = "Local Sensitivity of R0 with respect to SD_M", x = "SD of Mosquito Serial Interval Distribution (sd_m in days)", y = "Basic Reproduction Number (R0)")
# Testing R0 function with perfect exponential data (2^x)
calc_basicR(cases = c(1,2,4,8,16,32,64,128), 4, 2, 4, 2, weekly_data = FALSE)
barplot(c(1,2,4,8,16,32,64,128) ~c(1,2,3,4,5,6,7,8))
# 2014 epidemic data
#subset data
daily2014_epidemic <- dengue_daily2014[180:365, ]
daily2014_epidemic
#plot original dataset
barplot(dengue_daily2014$Cases ~ dengue_daily2014$Date, main = "2014 Daily Case Data", xlab = "Date", ylab = "Dengue Cases")
#plot data subset
barplot(daily2014_epidemic$Cases ~ daily2014_epidemic$Date, main = "2014 Daily Case Data, Epidemic Period", xlab = "Date", ylab = "Dengue Cases")
#calculate base case R0 for subset
calc_basicR(cases = daily2014_epidemic$Cases, mean_h = 4, sd_h = 2, mean_m = 4, sd_m = 2, weekly_data = FALSE)
#create sensitivity plots
# Create vectors for parameter changes
change_mean_h_daily <- c()
change_mean_m_daily <- c()
change_sd_h_daily <- c()
change_sd_m_daily <- c()
#loop through all values for mean_m and mean_h, calculating and storing corresponding R0
for(i in c(1:21)){
change_mean_h_daily[i] <- calc_basicR(cases = daily2014_epidemic$Cases,
mean_h = i, mean_m = 4, sd_h = 2, sd_m = 2, weekly_data = FALSE)
change_mean_m_daily[i] <- calc_basicR(cases = daily2014_epidemic$Cases,
mean_h = 4, mean_m = i, sd_h = 2, sd_m = 2, weekly_data = FALSE)
}
#loop through all values for sd_m and sd_h, calculating and storing corresponding R0
for(i in c(1:4)){
change_sd_h_daily[i] <- calc_basicR(cases = daily2014_epidemic$Cases,
mean_h = 4, mean_m = 4, sd_h = i, sd_m = 2,  weekly_data = FALSE)
change_sd_m_daily[i] <- calc_basicR(cases = daily2014_epidemic$Cases,
mean_h = 4, mean_m = 4, sd_h = 2, sd_m = i, weekly_data = FALSE)
}
#transform output into numeric vectors
change_mean_h_daily <- as.numeric(change_mean_h_daily)
change_mean_m_daily <- as.numeric(change_mean_m_daily)
change_sd_h_daily <- as.numeric(change_sd_h_daily)
change_sd_m_daily <- as.numeric(change_sd_m_daily)
#create data frames to plot results with
mean_h_sens_daily <- data.frame(mean_h = 1:21, R0 = change_mean_h_daily)
mean_m_sens_daily <- data.frame(mean_m = 1:21, R0 = change_mean_m_daily)
sd_h_sens_daily <- data.frame(sd_h = 1:5, R0 = change_sd_h_daily)
calc_basicR_LOGNORMAL <- function(cases, mean_h, sd_h, mean_m, sd_m, weekly_data) {
# calculates numerator (sum from t=1 to tfinal, of Nt for Humans)
sum_numerator <- sum(cases)
# calculate denominator
# calculates inside sum from u=1 to s
innersum <- function(s, t){ # +1 outside (t-s+1-u) is for 1-based indexing, so no out of bounds issues
sum(sapply(1:(t-s+1), function(u) sum(cases[(t-s+1-u)+1] * dlnorm(u, meanlog = mean_h, sdlog = sd_h, log = FALSE))) * dlnorm(s, meanlog = mean_m, sdlog = sd_m))
}
# calculates inside sum from s=1 to t
middlesum <- function(t){
sum(sapply(1:t,innersum, t = t))
}
#calculates outside sum from t=1 to tfinal-1 because use first as t = 0)
denom <- sum(sapply(1:length(cases), middlesum))
#final R0
R0 <- sqrt(sum_numerator/denom)
R0_info <- list("cases" = cases[1:length(cases)], "total cases (numerator)" = sum_numerator, "sum denominator" = denom, "R0" =R0)
return(R0)
}
calc_basicR_LOGNORMAL(cases = c(1,2,4,8,16,32,64,128), mean_h = 5, sd_h = 2, mean_m = 5, sd_m = 2, weekly_data = FALSE)
calc_basicR_LOGNORMAL(cases = daily2014_growth, mean_h = 5, sd_h = 2, mean_m = 5, sd_m = 2, weekly_data = FALSE)
calc_basicR_LOGNORMAL(cases = daily2014_growth$Cases, mean_h = 5, sd_h = 2, mean_m = 5, sd_m = 2, weekly_data = FALSE)
calc_basicR_LOGNORMAL(cases = daily2014_growth$Cases, mean_h = 4, sd_h = 2, mean_m = 4, sd_m = 2, weekly_data = FALSE)
reticulate::repl_python()
